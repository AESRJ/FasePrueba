name: Deploy to GitHub Pages

on:
  push:
    branches: [ master ]

permissions:
  contents: write

jobs:
  build-and-deploy:
    concurrency: ci-${{ github.ref }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install Pygbag
        run: |
          pip install pygbag

      - name: Build Game
        run: |
          cd $GITHUB_WORKSPACE
          pygbag --build main.py
          mv build/web/main.html build/web/index.html || true

      # --- NUEVO PASO: DISEÑO CYBERPUNK ---
      - name: Beautify HTML
        run: |
          import os
          
          html_path = 'build/web/index.html'
          
          # Estilos CSS Cyberpunk: Fondo de rejilla y borde de neón
          custom_style = """
          <style>
              body {
                  background-color: #050510; /* Fondo casi negro */
                  /* Patrón de rejilla Cyberpunk */
                  background-image: 
                      linear-gradient(rgba(0, 255, 255, 0.1) 1px, transparent 1px),
                      linear-gradient(90deg, rgba(0, 255, 255, 0.1) 1px, transparent 1px);
                  background-size: 40px 40px;
                  /* Centrar el juego */
                  display: flex;
                  justify-content: center;
                  align-items: center;
                  height: 100vh;
                  margin: 0;
                  overflow: hidden;
              }
              /* El lienzo del juego (Canvas) */
              canvas {
                  box-shadow: 0 0 50px rgba(0, 255, 255, 0.4); /* Resplandor Cian */
                  border: 2px solid #00ffff; /* Borde Cian */
                  border-radius: 8px; /* Bordes redondeados */
              }
          </style>
          """
          
          # Leemos el HTML generado
          with open(html_path, 'r', encoding='utf-8') as f:
              content = f.read()
          
          # Inyectamos el estilo antes de cerrar el head
          content = content.replace('</head>', custom_style + '</head>')
          
          # Guardamos el HTML mejorado
          with open(html_path, 'w', encoding='utf-8') as f:
              f.write(content)
        shell: python

      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: build/web